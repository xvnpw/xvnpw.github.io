<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Security Coding in Go. Input validation - xvnpw personal blog</title><link rel=icon type=image/png href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Input validation is one of most important technique in secure coding. Deep dive into it for Go language."><meta property="og:image" content><meta property="og:url" content="https://xvnpw.github.io/posts/security-coding-in-go-input-validation/"><meta property="og:site_name" content="xvnpw personal blog"><meta property="og:title" content="Security Coding in Go. Input validation"><meta property="og:description" content="Input validation is one of most important technique in secure coding. Deep dive into it for Go language."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-01T15:59:02+01:00"><meta property="article:modified_time" content="2023-08-01T15:59:02+01:00"><meta property="article:tag" content="Appsec"><meta property="article:tag" content="Go"><meta property="article:tag" content="Golang"><meta property="article:tag" content="Security-Coding"><meta property="article:tag" content="Validation"><meta name=twitter:card content="summary"><meta name=twitter:title content="Security Coding in Go. Input validation"><meta name=twitter:description content="Input validation is one of most important technique in secure coding. Deep dive into it for Go language."><script src=https://xvnpw.github.io/js/feather.min.js></script><link href=https://xvnpw.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://xvnpw.github.io/css/main.5cebd7d4fb2b97856af8d32a6def16164fcf7d844e98e236fcb3559655020373.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://xvnpw.github.io/css/dark.d22e2a2879d933a4b781535fc4c4c716e9f9d35ea4986dd0cbabda82effc4bdd.css disabled><link rel=stylesheet type=text/css href=https://xvnpw.github.io/css/my.0b83e2a92adf566deab02a012390927b24d79d5dc5a21a839eb61419dc041acc.css></head><body><div class=content><header><div class=main><a href=https://xvnpw.github.io/>xvnpw personal blog</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a>
| <span id=dark-mode-toggle onclick=toggleTheme()></span>
<script src=https://xvnpw.github.io/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>Security Coding in Go. Input validation</h1><div class=meta>Posted on Aug 1, 2023</div></div><section class=body><p>Input validation is one of most important technique in secure coding. Deep dive into it for Go language.</p><p>From <a href=https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html>OWASP</a>:</p><blockquote><p>Input validation is performed to ensure only properly formed data is entering the workflow in an information system.</p></blockquote><blockquote><p>Input validation should happen as early as possible in the data flow, preferably as soon as the data is received from the external party.</p></blockquote><blockquote><p>Data from all <strong>potentially untrusted sources</strong> should be subject to input validation, including not only Internet-facing web clients but also backend feeds over extranets, from suppliers, partners, vendors or regulators, each of which may be compromised on their own and start sending malformed data.</p></blockquote><h2 id=input-processing-model---developer-vs-hacker>Input Processing Model - Developer vs Hacker</h2><figure class=image-center><img src=https://github.com/xvnpw/xvnpw.github.io/assets/17719543/dce28b3f-952b-4d0e-a396-3cae02413f70></figure><p>In this article I will focus on finding loophols in typical input validation techniques. Hackers are targeting those to bypass filtering and achieve goals. Typical example of such problem is <code>.</code> vs <code>\.</code> in regex. We will take a look on that later.</p><h2 id=why-we-should-use-it>Why we should use it?</h2><ul><li>for data consistency</li><li>make life harder for hackers (and more fun as they will search for bypass)</li><li><strong>essential</strong> for defending against some attack types - e.g. domain validation in case of Server Side Request Forger (SSRF)</li></ul><figure class=image-center><img src=https://github.com/xvnpw/xvnpw.github.io/assets/17719543/8226da79-2e3d-49cb-a8f7-b114563186fc></figure><h2 id=common-validation-issues>Common validation issues</h2><h3 id=regex-dot>Regex dot</h3><p>In regex, it easy to forget about <code>.</code> meaning, especially in domain validation:</p><ul><li><code>.</code> - any single character</li><li><code>\.</code> - dot character</li></ul><p>‚ùå <strong>Bad code</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>matched</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>regexp</span>.<span style=color:#a6e22e>Match</span>(<span style=color:#e6db74>`^(test|stage|prod).example.com$`</span>, []byte(<span style=color:#a6e22e>domain</span>))
</span></span><span style=display:flex><span><span style=color:#75715e>// prod-example.com
</span></span></span></code></pre></div><p>‚úÖ <strong>Correct code</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>matched</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>regexp</span>.<span style=color:#a6e22e>Match</span>(<span style=color:#e6db74>`^(test|stage|prod)\.example\.com$`</span>, []byte(<span style=color:#a6e22e>domain</span>))
</span></span></code></pre></div><h3 id=regex-matching-whole-input>Regex matching whole input</h3><p>In regex, in <code>go</code>, your regular expression is not matched against whole input. You need to add <code>^</code> to beginning and <code>$</code> to ending.</p><p>‚ùå <strong>Bad code</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>re</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>regexp</span>.<span style=color:#a6e22e>MustCompile</span>(<span style=color:#e6db74>`test\.example\.com`</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// test.example.com.my-bad-domain.com
</span></span></span></code></pre></div><p>‚úÖ <strong>Correct code</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>re</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>regexp</span>.<span style=color:#a6e22e>MustCompile</span>(<span style=color:#e6db74>`^test\.example\.com$`</span>)
</span></span></code></pre></div><h3 id=wrong-regex---range-problem>Wrong regex - range problem</h3><p><code>[A-z]</code>: A-z matches a single character in the range between A (index 65) and z (index 122) - which includes, e.g. <code>[</code>, <code>\</code>, <code>]</code></p><p>‚ùå <strong>Bad code</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>^[A-z0-9]{4}$
</span></span></code></pre></div><p>‚úÖ <strong>Correct code</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>^[a-zA-Z0-9]{4}$
</span></span></code></pre></div><p>‚≠ê <strong>Important:</strong> Validation is not proven to work if not tested</p><h3 id=email-address-validation>Email Address Validation</h3><p>Email format is defined by <a href=https://tools.ietf.org/html/rfc5321#section-4.1.2>RFC 5321</a>, but it&rsquo;s quite wide. Those all are <strong>valid</strong>:</p><ul><li><code>">&lt;script>alert(1);&lt;/script>"@example.org</code></li><li><code>user+subaddress@example.org</code></li><li><code>user@[IPv6:2001:db8::1]</code></li><li><code>" "@example.org</code></li></ul><p>Try to register <code>">&lt;script>alert(1);&lt;/script>"</code> in gmail. What will you get?</p><p>Following <strong>Bad code</strong> is wrong, because it only relay on RFC 5321. OWASP is giving more <a href=https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html#email-address-validation>strict rules</a> for validation.</p><p>‚ùå <strong>Bad code</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;net/mail&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>input</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>`&#34;&gt;&lt;script&gt;alert(1);&lt;/script&gt;&#34;@example.org`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>e</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mail</span>.<span style=color:#a6e22e>ParseAddress</span>(<span style=color:#a6e22e>input</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// &#34;&gt;&lt;script&gt;alert(1);&lt;/script&gt;&#34;@example.org
</span></span></span></code></pre></div><p>‚≠ê <strong>Important:</strong> There is no perfect validation of email address</p><p>‚úÖ <strong>Correct code</strong> - based on OWASP Validation Regex Repository</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>isEmailValid</span>(<span style=color:#a6e22e>input</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// RFC 5321 validation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mail</span>.<span style=color:#a6e22e>ParseAddress</span>(<span style=color:#a6e22e>input</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>regexp</span>.<span style=color:#a6e22e>MustCompile</span>(<span style=color:#e6db74>`^[a-zA-Z0-9_+&amp;*-]+(?:\.[a-zA-Z0-9_+&amp;*-]+)*@(?:[a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}$`</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Match</span>([]byte(<span style=color:#a6e22e>input</span>)) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>‚úÖ <strong>Correct code</strong> - based on OWASP Cheat Sheet</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>isEmailValid</span>(<span style=color:#a6e22e>input</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// RFC 5321 validation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mail</span>.<span style=color:#a6e22e>ParseAddress</span>(<span style=color:#a6e22e>input</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>parts</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Split</span>(<span style=color:#a6e22e>input</span>, <span style=color:#e6db74>&#34;@&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// we don&#39;t allow some special characters in email part
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>ContainsAny</span>(<span style=color:#a6e22e>parts</span>[<span style=color:#ae81ff>0</span>], <span style=color:#e6db74>`&#34;&#39;/\;&lt;&gt;`</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// something is not right with utf8
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>input</span>) <span style=color:#f92672>!=</span> <span style=color:#a6e22e>utf8</span>.<span style=color:#a6e22e>RuneCountInString</span>(<span style=color:#a6e22e>input</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// domain part should contain only letters, numbers, hyphens and periods
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>regexp</span>.<span style=color:#a6e22e>MustCompile</span>(<span style=color:#e6db74>`^[a-zA-Z0-9\.-]*$`</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Match</span>([]byte(<span style=color:#a6e22e>parts</span>[<span style=color:#ae81ff>1</span>])) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// email part should be no more than 63 characters
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>parts</span>[<span style=color:#ae81ff>0</span>]) &gt; <span style=color:#ae81ff>63</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// total length should be no more than 254 characters
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>input</span>) &gt; <span style=color:#ae81ff>254</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>‚ùì If you don&rsquo;t like above. Can you understand this regex?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// https://github.com/asaskevich/govalidator
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Email</span> <span style=color:#66d9ef>string</span> = <span style=color:#e6db74>&#34;^(((([a-zA-Z]|\\d|[!#\\$%&amp;&#39;\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\x{00A0}-\\x{D7FF}\\x{F900}-\\x{FDCF}\\x{FDF0}-\\x{FFEF}])+(\\.([a-zA-Z]|\\d|[!#\\$%&amp;&#39;\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\x{00A0}-\\x{D7FF}\\x{F900}-\\x{FDCF}\\x{FDF0}-\\x{FFEF}])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\x{00A0}-\\x{D7FF}\\x{F900}-\\x{FDCF}\\x{FDF0}-\\x{FFEF}])|(\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\x{00A0}-\\x{D7FF}\\x{F900}-\\x{FDCF}\\x{FDF0}-\\x{FFEF}]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-zA-Z]|\\d|[\\x{00A0}-\\x{D7FF}\\x{F900}-\\x{FDCF}\\x{FDF0}-\\x{FFEF}])|(([a-zA-Z]|\\d|[\\x{00A0}-\\x{D7FF}\\x{F900}-\\x{FDCF}\\x{FDF0}-\\x{FFEF}])([a-zA-Z]|\\d|-|\\.|_|~|[\\x{00A0}-\\x{D7FF}\\x{F900}-\\x{FDCF}\\x{FDF0}-\\x{FFEF}])*([a-zA-Z]|\\d|[\\x{00A0}-\\x{D7FF}\\x{F900}-\\x{FDCF}\\x{FDF0}-\\x{FFEF}])))\\.)+(([a-zA-Z]|[\\x{00A0}-\\x{D7FF}\\x{F900}-\\x{FDCF}\\x{FDF0}-\\x{FFEF}])|(([a-zA-Z]|[\\x{00A0}-\\x{D7FF}\\x{F900}-\\x{FDCF}\\x{FDF0}-\\x{FFEF}])([a-zA-Z]|\\d|-|_|~|[\\x{00A0}-\\x{D7FF}\\x{F900}-\\x{FDCF}\\x{FDF0}-\\x{FFEF}])*([a-zA-Z]|[\\x{00A0}-\\x{D7FF}\\x{F900}-\\x{FDCF}\\x{FDF0}-\\x{FFEF}])))\\.?$&#34;</span>
</span></span></code></pre></div><h4 id=online-validation>Online validation</h4><p>‚ùå There are libraries like <a href=https://github.com/badoux/checkmail>https://github.com/badoux/checkmail</a> that can do online validation, asking SMTP server if mailbox exists on it. It&rsquo;s not perfect and can be misleading.</p><h4 id=semantic-validation>Semantic validation</h4><p>Semantic validation provides basic level of assurance that:</p><ul><li>email address is correct</li><li>application can successfully send emails to it</li><li>user has access to the mailbox</li></ul><p>‚úÖ The most common way to do this is to send an email to the user, and require that they click a link in the email, or enter a code that has been sent to them.</p><h3 id=unicode-case-mapping-collisions->Unicode Case Mapping Collisions üí•</h3><p>Unicode Case Mapping Collisions occur when two different characters are uppercased or lowercased into the same character.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>ToUpper</span>(<span style=color:#a6e22e>ƒ±</span>) <span style=color:#75715e>// ƒ± is dotless i, used in Turkish alphabet 
</span></span></span><span style=display:flex><span><span style=color:#75715e>// I
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>ToUpper</span>(<span style=color:#a6e22e>≈ø</span>) <span style=color:#75715e>// ≈ø is latin small letter Long S
</span></span></span><span style=display:flex><span><span style=color:#75715e>// S
</span></span></span></code></pre></div><p><code>go</code> function list, that can end up with collision:</p><ul><li><code>strings.ToLower(input)</code></li><li><code>strings.ToUpper(input)</code></li><li><code>bytes.ToLower(input)</code></li><li><code>bytes.ToUpper(input)</code></li><li><code>norm.NFC.String(input)</code></li><li><code>norm.NFKC.String(input)</code></li></ul><p>‚ùå <strong>Bad code</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>ToUpper</span>(<span style=color:#a6e22e>s1</span>) <span style=color:#f92672>==</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>ToUpper</span>(<span style=color:#a6e22e>s2</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// ƒ±test == itest
</span></span></span></code></pre></div><p>‚úÖ <strong>Correct code</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>s1</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>s2</span>
</span></span></code></pre></div><p>How to prevent it:</p><ul><li><a href=https://www.compart.com/en/unicode/U+0131>accept fact</a> that some letters have collision on uppercased or lowercased: <code>ƒ±</code> -> <code>I</code></li><li>be careful in any sensitive context - e.g. <code>username</code> - best to handle it as is, without any transformation</li><li>in case you have requirement on case insensitive - be consistent - normalize or transform you input always in same way</li><li>use <code>utf8</code> package, e.g. <code>len(x)</code> vs <code>utf8.RuneCountInString(x)</code></li></ul><h4 id=read-more>Read more</h4><ul><li><a href=https://dev.to/jagracey/hacking-github-s-auth-with-unicode-s-turkish-dotless-i-460n>https://dev.to/jagracey/hacking-github-s-auth-with-unicode-s-turkish-dotless-i-460n</a></li><li><a href=https://www.gosecure.net/blog/2020/08/04/unicode-for-security-professionals/>https://www.gosecure.net/blog/2020/08/04/unicode-for-security-professionals/</a></li><li><a href=https://henvic.dev/posts/go-utf8/>https://henvic.dev/posts/go-utf8/</a></li></ul><h3 id=blacklisting-vs-whitelisting>Blacklisting vs whitelisting</h3><p>Prefer whitelist over blacklist.</p><h2 id=model-validation-using-go-swagger>Model validation using <code>go-swagger</code></h2><p><code>go-swagger</code> package can parse swagger file and generate model. This model includes validations.</p><p>‚≠ê <strong>Important:</strong> It doesn&rsquo;t generate validation code for path and query parameters.</p><h2 id=interesting-regex>Interesting regex</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// https://github.com/asaskevich/govalidator
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>UUID4</span> <span style=color:#66d9ef>string</span> = <span style=color:#e6db74>&#34;^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>userRegexp</span> = <span style=color:#a6e22e>regexp</span>.<span style=color:#a6e22e>MustCompile</span>(<span style=color:#e6db74>&#34;^[a-zA-Z0-9!#$%&amp;&#39;*+/=?^_`{|}~.-]+$&#34;</span>)
</span></span></code></pre></div><h2 id=validation-techniques-theory>Validation Techniques Theory</h2><ul><li>Whitelisting - whenever possible validate the input against a whitelist of allowed characters.</li><li>Boundary checking - both data and numbers length should be verified.</li><li>Character escaping - for special characters such as standalone quotation marks.</li><li>Numeric validation - if input is numeric.</li><li>Check for Null Bytes - <code>(%00)</code></li><li>Checks forpath alteration characters - <code>../</code> or <code>\\..</code></li><li>Checks for Extended UTF-8 - check for alternative representations of special characters</li></ul><h2 id=validation-in-go>Validation in <code>go</code></h2><ul><li><a href=https://github.com/go-playground/validator>https://github.com/go-playground/validator</a></li><li><a href=https://github.com/gorilla/schema>https://github.com/gorilla/schema</a></li><li><a href=https://github.com/go-playground/form>https://github.com/go-playground/form</a></li><li><a href=https://github.com/go-ozzo/ozzo-validation>https://github.com/go-ozzo/ozzo-validation</a></li><li><a href=https://github.com/asaskevich/govalidator>https://github.com/asaskevich/govalidator</a></li><li>package <code>strconv</code>, e.g. <code>Atoi</code>, <code>ParseBool</code>, <code>ParseFloat</code>, <code>ParseInt</code></li><li>package <code>strings</code>, e.g. <code>Contains</code>, <code>HasPrefix</code>, <code>HasSuffix</code></li><li>package <code>regexp</code></li><li>package <code>utf8</code>, e.g. <code>Valid</code>, <code>ValidRune</code>, <code>ValidString</code></li></ul><p>If you have any comments or feedback, you are welcome to write to me on <a href=https://twitter.com/xvnpw>Twitter</a>.</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/appsec>appsec</a></li><li><a href=/tags/go>go</a></li><li><a href=/tags/golang>golang</a></li><li><a href=/tags/security-coding>security-coding</a></li><li><a href=/tags/validation>validation</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/xvnpw rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://twitter.com/xvnpw rel=me title=Twitter><i data-feather=twitter></i></a>
<a class=border></a><a class=soc href=https://www.linkedin.com/in/marcin-niemiec-304349104/ rel=me title=Linkedin><i data-feather=linkedin></i></a>
<a class=border></a></div><div class=footer-info>2024 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script async src="https://www.googletagmanager.com/gtag/js?id=G-YHETMXZXMZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YHETMXZXMZ")}</script><script>feather.replace()</script></div></body></html>