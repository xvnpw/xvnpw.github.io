<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>FromÂ . in regex to SSRFâ€Š-â€ŠpartÂ 1 - xvnpw personal blog</title><link rel=icon type=image/png href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In test of one application I have encountered bug in regex that leaded to Server Side Request Forgery (SSRF). Way of finding it was huge fun and excitement. It was also my first bug on production system ever."><meta property="og:image" content><meta property="og:title" content="FromÂ . in regex to SSRFâ€Š-â€ŠpartÂ 1"><meta property="og:description" content="In test of one application I have encountered bug in regex that leaded to Server Side Request Forgery (SSRF). Way of finding it was huge fun and excitement. It was also my first bug on production system ever."><meta property="og:type" content="article"><meta property="og:url" content="https://xvnpw.github.io/posts/from-dot-in-regex-to-ssrf-part-1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-01-05T10:14:47+01:00"><meta property="article:modified_time" content="2020-01-05T10:14:47+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="FromÂ . in regex to SSRFâ€Š-â€ŠpartÂ 1"><meta name=twitter:description content="In test of one application I have encountered bug in regex that leaded to Server Side Request Forgery (SSRF). Way of finding it was huge fun and excitement. It was also my first bug on production system ever."><script src=https://xvnpw.github.io/js/feather.min.js></script>
<link href=https://xvnpw.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://xvnpw.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://xvnpw.github.io/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css disabled><link rel=stylesheet type=text/css href=https://xvnpw.github.io/css/my.0b83e2a92adf566deab02a012390927b24d79d5dc5a21a839eb61419dc041acc.css></head><body><div class=content><header><div class=main><a href=https://xvnpw.github.io/>xvnpw personal blog</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a>
| <span id=dark-mode-toggle onclick=toggleTheme()></span>
<script src=https://xvnpw.github.io/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>FromÂ . in regex to SSRFâ€Š-â€ŠpartÂ 1</h1><div class=meta>Posted on Jan 5, 2020</div></div><section class=body><figure class=image-center><img src=https://user-images.githubusercontent.com/17719543/139576912-865d0f16-6dc3-4af9-8a39-5e77d7b236c3.png></figure><p>In test of one application I have encountered bug in regex that leaded to Server Side Request Forgery (SSRF). Way of finding it was huge fun and excitement. It was also my first bug on production system ever.</p><p>During a recon I have found service called <em>image-converter</em>. It was definitely interesting, but not straight forward to exploit. I had no example of usage it and on simple GET request I was just getting:</p><figure><img src=https://user-images.githubusercontent.com/17719543/139576933-06cadc0d-6489-4ac1-8e58-292d5fb1baf8.png></figure><p>That was first major problem for me. I was trying with some simple query parameters like:</p><ul><li><code>?url=</code></li><li><code>?width=</code></li><li><code>?name=</code></li></ul><p>and so on but without luck. Then I tried with <a href=https://github.com/s0md3v/Arjun>https://github.com/s0md3v/Arjun</a> which is tool for automated parameter discovery. This also failed. I was pretty sure that there is something out there, but I couldn&rsquo;t force it to work.</p><p>Then I started digging in what is this error message that I see all the time: <code>"Cannot read property 'groups' of null"</code>. This leads me to stackoverflow question about JavaScript and regex error. After that I was wondering: &ldquo;How the hell they have implemented this?&rdquo;. After hour of trying and failure, I got it:</p><p><code>https://api.example.org/image-converter/width=100/http://google.com</code></p><figure><img src=https://user-images.githubusercontent.com/17719543/139577018-2487fddb-ef0a-449b-a893-7ad929e4aa0b.png></figure><p>In my almost 10 years IT career, I didn&rsquo;t see service implementation like thatÂ ðŸ˜‰</p><p>My positive energy went down, as I realized that there is domain whitelisting implemented. I have picked main domain <code>www.example.org</code> and in fact it was working:</p><p><code>https://api.example.org/image-converter/width=100/https://www.example.org</code></p><p>I got response:</p><figure><img src=https://user-images.githubusercontent.com/17719543/139577079-083fd93f-3679-4487-9f91-4d7f8fec6be8.png></figure><p>In this moment I was sure about SSRF, but still had whitelisting to bypass.</p><p>My first approach was to take SSRF from <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery>PayloadAllTheThings</a> and test it. I don&rsquo;t want to copy all that here. There is dozen of payloads. Sadly not of it worked. I got very interested in <a href=https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf>Orange: A New Era SSRF</a>, but that was also death end.</p><p>I was pretty puzzled. Having high hope on some nice bug, but it looked like this service was secured. Good thing was that I have learned a lot, especially from Orange paper.</p><p>Next day with fresh head I took different way. During recon I have noted two other domains connected with main one: <code>www.example.net</code> and <code>www.example.com</code>. It turn out that those domains where also whitelisted. Having a background in programming I knew that developers have a tendency to write &ldquo;nice code&rdquo;, so maybe they used regex to check domain suffix? And guess what? They did! For request:</p><p><code>https://api.example.org/image-converter/width=100/https://www-example.org</code></p><p>I got response:</p><figure><img src=https://user-images.githubusercontent.com/17719543/139577185-1b2711fb-6a19-435e-8bd3-015deb803884.png></figure><p>Hurray!</p><p>What exactly regex they usedÂ ? I think something like this regex101:</p><figure><img src=https://user-images.githubusercontent.com/17719543/139577198-3c7995e4-d9ef-4c83-ad57-2608c17305ed.png></figure><p>And what they should use is: <code>www\.example\.(com|net|org)</code></p><p>Next I have registered <code>www-example.com</code> domain and started playing with escalation this. More about it in part 2.</p><hr><p>Thanks for reading! You can follow me on <a href=https://twitter.com/xvnpw>Twitter</a>.</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/ssrf>SSRF</a></li><li><a href=/tags/bugbounty>bugbounty</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/xvnpw rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://twitter.com/xvnpw rel=me title=Twitter><i data-feather=twitter></i></a>
<a class=border></a></div><div class=footer-info>2023 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-YHETMXZXMZ","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script>feather.replace()</script></div></body></html>